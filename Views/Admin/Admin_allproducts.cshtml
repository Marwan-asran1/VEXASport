﻿
@model List<VEXA.Models.Product>
@{
    ViewBag.Title = "Products Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


<div class="container-fluid">
    <h1 class="h3 mb-2 text-gray-800">Products Management</h1>
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">All Products</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive products-table">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Gender</th>
                            <th>Size</th>
                            <th>Type</th>
                            <th>Variants</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in Model)
                        {
                            <tr>
                                <td>@product.Id</td>
                                <td>@product.Name</td>
                                <td>$@product.Price</td>
                                <td>@product.Gender</td>
                                <td>
                                    @if (product.Variants != null && product.Variants.Any())
                                    {
                                        @string.Join(", ", product.Variants.OrderBy(v => v.Size).Select(v => v.Size.ToString()))
                                    }
                                    else
                                    {
                                        <span class="text-muted">No variants</span>
                                    }
                                </td>
                                <td>@product.ProductType</td>
                                <td>@(product.Variants == null ? 0 : product.Variants.Count)</td>
                                <td>
                                    <button class="btn-edit" onclick="openEditModal(@product.Id)">Edit</button>
                                    <button class="btn-edit" onclick="openVariantsModal(@product.Id, '@product.Name')">Variants</button>
                                    <form asp-controller="Admin" asp-action="DeleteProduct" asp-route-id="@product.Id" 
                                          method="post" style="display:inline;"
                                          onsubmit="return confirm('Are you sure you want to delete this product?');">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn-delete">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Product Modal -->
<div id="productModal" class="modal product-form-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Add New Product</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <form id="productForm" method="post" asp-controller="Admin" asp-action="CreateProduct">
            @Html.AntiForgeryToken()
            <input type="hidden" id="productId" name="Id" value="0" />
            <input type="hidden" id="productRowVersion" name="RowVersion" />
            
            <!-- Two-column row for basic info -->
            <div class="form-row">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" class="form-control" id="productName" name="Name" 
                           placeholder="Enter product name" required />
                </div>
                
                <div class="form-group">
                    <label for="productPrice">Price</label>
                    <input type="number" class="form-control" id="productPrice" name="Price" 
                           placeholder="Enter price" step="0.01" min="0" required />
                </div>
            </div>
            
            <!-- Full-width description -->
            <div class="form-group form-group-full">
                <label for="productDescription">Description</label>
                <textarea class="form-control" id="productDescription" name="Description" 
                          placeholder="Enter product description" rows="2" required></textarea>
            </div>
            
            <!-- Two-column row for image and gender -->
            <div class="form-row">
                <div class="form-group">
                    <label for="productImageUrl">Image URL</label>
                    <input type="url" class="form-control" id="productImageUrl" name="ImageUrl" 
                           placeholder="Enter image URL (optional)" />
                </div>
                
                <div class="form-group">
                    <label>Gender</label>
                    <select class="form-control" id="productGender" name="Gender" required>
                        <option value="Men">Men</option>
                        <option value="Women">Women</option>
                        <option value="Kids">Kids</option>
                    </select>
                </div>
            </div>
            
            <!-- Two-column row for product type and variants -->
            <div class="form-row">
                <div class="form-group">
                    <label>Product Type</label>
                    <select class="form-control" id="productType" name="ProductType" required>
                        <option value="Tops">Tops</option>
                        <option value="Bottoms">Bottoms</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Quick Add Variants</label>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addVariant()" style="width: 100%;">Add Size Variant</button>
                </div>
            </div>
            
            <!-- Full-width variants section -->
            <div class="form-group form-group-full">
                <label>Product Variants (Size & Stock)</label>
                <div id="variantsContainer">
                    <div class="variant-row">
                        <select class="form-control variant-size" name="VariantSizes">
                            <option value="S">Small (S)</option>
                            <option value="M">Medium (M)</option>
                            <option value="L">Large (L)</option>
                        </select>
                        <input type="number" class="form-control variant-stock" name="VariantStocks" placeholder="Stock Quantity" min="0" value="10">
                        <button type="button" class="btn btn-danger btn-sm remove-variant" onclick="removeVariant(this)">Remove</button>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-success mt-3" id="productSubmitButton" style="width: 100%;">Save Product</button>
            </form>
        </div>
    </div>
</div>

<!-- Variants Modal -->
<div id="variantsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
        <h2 id="variantsTitle">Manage Variants</h2>
        <span class="close close-variants">&times;</span>
    </div>
    <div class="modal-body">
        <div id="variantsList"></div>

        <form id="variantForm" method="post" asp-controller="Admin" asp-action="AddOrUpdateVariant">
      @Html.AntiForgeryToken()
      <input type="hidden" id="variantProductId" name="productId" />
      <div class="form-group">
        <label>Size</label>
        <select class="form-control" id="variantSize" name="size" required>
          <option value="XS">XS</option>
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
          <option value="XXL">XXL</option>
        </select>
      </div>
      <div class="form-group">
        <label>Stock</label>
        <input type="number" class="form-control" id="variantStock" name="stockQuantity" min="0" required />
      </div>
      <button type="submit" class="btn btn-success mt-2">Save Variant</button>
        </form>
    </div>
  </div>
</div>

<!-- Add the green + button after the table -->
<button class="btn-add" onclick="openAddProductModal()">+</button>

